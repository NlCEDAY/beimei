## 用户画像系列（二）：

### 用户画像模块分类：

#### 用户画像基础：

> 了解大方向的规划，数据仓库架构是什么样，开发流程，表结构设计，ETL设计

- 标签类型
- 数据架构
- 开发流程
- 常见表结构设计
  - 日增量数据
  - 日全量数据

#### 数据指标体系：

> 根据业务线，建设用户属性，用户行为，用户消费，风险控制等维度的指标。

- 用户属性维度标签
  - 常见用户属性
  - 用户性别
- 用户行为维度标签
- 用户消费维度标签
- 风险控制维度标签
- 标签命名方式

#### 标签数据存储：

> 建设标签相关数据存储数据库，可选Hive，Mysql，HBase，ElasticSearch，根据不同场景选择

- Hive存储
  - 分区插入数据
  - 标签 ID-Maping
- Mysql存储
  - 元数据管理
  - 标签量级监控
  - 结果集监控
- HBase存储
- ES存储

#### 标签数据开发：

- 用户画像
- 统计类标签开发
- 规则类标签开发
  - 数据调研
  - 确定业务规则
- 挖掘类标签开发
- 流式计算标签开发
  - 读取kafka数据
  - 标签开发
  - 上线工程化
- 打通数据服务层

### 用户画像基础详解：

#### 一：标签类型：

- 统计类标签

  > 最为常见且基础，对于用户来说，性别，年龄，城市，星座，近7日活跃时长，近7日活跃天数，近7日活跃次数

- 规则类标签

  > 基于用户行为及确定的规则产生，例如工作人员定义：近7日交易次数>=5，这个行为作为交易活跃的标签

- 机器学习挖掘类标签

  > 通过机器学习挖掘产生，比如用户的消费习惯，需要通过挖掘数据产生，该类标签作用在预测例如用户对商品的偏好程度上。

#### 二：数据架构：

![image-20200901183123773](C:%5CUsers%5Clenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200901183123773.png)

####  三：开发流程：

1. **第一阶段：目标解读**

   > 明确发布的对象--运营人员和数据分析人员对用户画像模型有各自不同的需求

2. **第二阶段：任务分解与需求调研**

   > 根据产品业务现有体系与规模，和数据字典规约实体与标签之间的关联，j将任务分解后从不同维度建立业务模型
   >
   > 类似，用户行为画像，用户群体偏好画像，用户属性画像，用户偏好画像。

3. **第三阶段：需求场景讨论与明确**

   > 跟需求方沟通结果，写出产品用户画像需求文档，
   >
   > 文档中需写清：画像应用场景，开发标签内容与应用方式。

4. **第四阶段：应用场景与数据口径确认**

   > 数据运营人员结合业务和场景与仓库表信息，与运营方达成一致的数据口径

5. **第五阶段：特征选取与模型数据落表**

   > 数据分析挖掘人员根据需求，将HQL逻辑写入临时表中，抽取数据 校验是否符合业务场景

6. **第六阶段：线下模型数据验收与测试**

   > 数仓人员将数据落表后，设置定时调度任务，定期增量更新数据，再次期间，不断校验数仓的HQL逻辑时候符合需求，数据是否在合理范围内，调整代码逻辑和行为权重的数值。

7. **第七阶段：线上模型发布与效果追踪**

   > 通过git进行版本管理，部署上线，实时追踪效果，调整优化模型及相关权重的配置

#### 表结构设计：

> 考虑
>
> 1.存储哪些信息
>
> 2.如何存储（数据分区）
>
> 3.如何应用（如何抽取标签）

##### 每日全量数据表结构：

> hive使用分区优化查询，表中日期分区记录着**从开始截止到当天**的全量用户数据

```sql
create table dw.userprofile_attritube_all(
	userid string,
    labelweight string
    ....
)
partitioned by (data_date string, theme string)
```



##### 每日增量数据表结构：

> hive表中日期分区记录着**当日的用户行为数据**

```sql
create table dw.userprofile_act_feature_append(
    labelid string,
    cookieid string,
    act_cnt int,
    tag_type_id int,
    act_type_id int
    ....
)
partitioned by (data_date string)
```

##### 宽表结构：

> 根据数据仓库星型模式的建模方式，将用户属性和用户日活跃详细设计

根据不同维度去对用户建立标签：

- 用户属性类
- 用户行为类
- 用户消费类
- 风险控制类



![image-20200901201659681](C:%5CUsers%5Clenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200901201659681.png)

