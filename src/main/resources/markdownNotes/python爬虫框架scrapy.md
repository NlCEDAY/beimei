## Scarpy框架爬虫：

### 数据采集来源：

- `从网上爬取数据（crawling）`
- `从本地系统收集数据（scraping）`
  - 文件，数据库等

### 常用数据爬取工具：

- `第三方库实现爬取`
  - Requests，lxml
- `PySpider爬虫框架`
  - 提供webUI界面编写及管理爬虫
  - 上手快，学习简单
- `Scrpay爬虫框架`
  - 功能强大
  - 可定制性强
  - 多线程，分布式，爬取效率高

### Scrapy框架组成：

- `spiders文件夹`
  - 定义爬虫文件
- `items.py`
  - 定义框架内数据传输格式
- `pipelines.py`
  - 数据保存模块
- `middlewares.py`
  - 中间件模块
- `settings.py`
  - 框架配置模块



### Scrapy返回爬取页面数据：

- 通过解析方法返回爬取页面数据
  - parse()方法的response参数
  - reponse对象常用属性和方法

| **属性或方法** | **作用**                                                     |
| -------------- | ------------------------------------------------------------ |
| url            | 当前返回数据所对应的页面url                                  |
| status         | http请求状态码                                               |
| meta           | 用于request与response之间的数据传递                          |
| body           | 返回页面html源码，如用纯正则表达式匹配数据需要获得页面html源码 |
| xpath()        | 使用xpath选择器解析网页                                      |
| css()          | 使用css选择器解析网页                                        |

### Scrapy爬虫框架提取网页数据的方法

- `xpath选择器`
  - 用于选择xml文档中节点的语言，可以与html一起使用
- `css选择器`
  - 用于将样式应用于html文档的语言
  - 将样式与特定的html元素相关联
- `正则表达式`
  - 提取非标签内容

#### xpath：

- 使用路径表达式来选取 XML 文档中的节点或节点集

| **表达式** | **描述**                                   |
| ---------- | ------------------------------------------ |
| nodename   | 选取的节点名                               |
| /          | 从根节点选取                               |
| //         | 选取所有符合条件的节点，而不考虑它们的位置 |
| .          | 选取当前节点                               |
| ..         | 选取当前节点的父节点                       |
| @          | 选取属性                                   |

- 路径表达式举例

| **路径表达式**         | **结果**                                                     |
| ---------------------- | ------------------------------------------------------------ |
| /bookstore             | 选取根元素  bookstore                                        |
| /bookstore/book        | 选取属于  bookstore 的子元素的所有 book 元素                 |
| //book                 | 选取所有  book 子元素，而不管它们在文档中的位置              |
| /bookstore//book       | 选择属于  bookstore 元素的后代的所有 book 元素，而不管它们位于 bookstore 之下的什么位置 |
| //@lang                | 选取名为  lang 的所有属性                                    |
| /bookstore/book/text() | 选取属于  bookstore 的子元素的所有 book 元素的文本           |

- **谓语**
  - 谓语用来查找某个特定节点或者包含某个指定的值的节点
  - 谓语被嵌在方括号中



| **路径表达式**       | **结果**                                        |
| -------------------- | ----------------------------------------------- |
| /bookstore/book[1]   | 选取属于  bookstore 子元素的第一个 book 元素    |
| //title[@lang]       | 选取所有拥有名为  lang 的属性的 title 元素      |
| //title[@lang='eng'] | 选取所有拥有值为  eng 的 lang 属性的 title 元素 |