## Flink流式数据架构（一）：

### 流：

#### 流是批得特例：

> 以批处理为基础，将我的批处理细粒度化成微批，每来一条处理一次
>
> SparkSteaming，
>
> （本身有攒批得逻辑，有对批处理进行调度计算得过程，会比真正得流计算慢一点 ）



#### 批是流得特例：

> 以流处理为基础，每条数据得到来触发一次计算，Flink

#### Flink引擎特性：

- 具有强一致性，支持exactly-once
- 提供丰富得时间工具，如事件时间，处理时间，窗口
- 保证系统具有可弹性，伸缩性
- 保证高吞吐，低延迟与容错
- 支持高层语义，如流式关系型API，复杂事件处理（CEP）

### 时间

- **事件时间：** 事件实际发生得时间
- **处理时间：** 事件被处理得时间

#### 事件时间与处理时间偏差原因：

- 受共享资源受限：如网络阻塞时延，网络分区，共享CPU
- 软件架构：如分布式系统中得并发竞争，时钟不一致。
- 数据自身特性：如key得特殊分布，吞吐量得快速涨落，乱序

### 窗口

> 将有界/无界数据集拆分成一个个有限长度得数据区间

- **滚动窗口：**

  > 将时间拆分成固定长度

- **滑动窗口：**

  > 按照滑动步长将时间拆分成固定长度

- **会话窗口：**

  > 以活动时间间隔为边界，将一系列连续事件拆分到不同得会话中

### 水印

> 嵌入在事件时间轴上用于判断**事件时间窗口内所有数据均已到达引擎**得一种时间推理工具。

### 触发器

> 决定在窗口什么时间点启动应用程序定义得数据处理任务

- 水印迟到会**拉长窗口生存期**
- 水印早到会**导致数据处理结果不准确**

### 无界数据得流式处理模式：

#### 时间无关：

> 解决与时间无关得数据任务

- 过滤：用于过滤给定规则得事件
- 连接：将两个数据源中相关联得记录连接为一条记录

#### 近似计算：

> 另一种解决与时间无关得数据任务

- **Streaming k-means：** 以空间中k个点为中心进行聚类
  - 初始以随机位置作为聚类中心点，因为还没有数据过来
  - 每收到新数据，调用**Streaming k-means** 算法 更新中心点
  - 以更新后得中心点为初始中心点，回跳步骤2

#### 根据处理时间开滚动窗口：

> 有点像微批

#### 根据事件时间开滚动窗口：

> 由于事件时间到来次序不定，时间不定，往往需要大容量持久化，窗口边界难以确定，事件易迟到窗口结束点难确定

##### what：

> 定义数据处理是什么，对其做怎样转换操作

##### where：

> 定义转换操作的输入数据来自哪个时间区间

##### when：

> 定义转换操作发生在时间轴的哪个时间点--水印和触发器

##### how：

> 定义如何刻画同一窗口多次转换操作结果的关系--累加模式